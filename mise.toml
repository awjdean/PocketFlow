[tools]
python = "3.12"
pixi = "0.62"
ruff = "0.14"
tombi = "0.7"

[tasks]
# Inference (default env)
install = "pixi install --locked"
smoke = "pixi run smoke"
test-load = "pixi run test-load-ckpt"
check-py = { description = "Check python code with ruff", run = "ruff check . && ruff format --check ." }
fix-py = { description = "Fix Python code with Ruff", run = "ruff format . && ruff check --fix ." }
check-toml = { description = "Check TOML files with Tombi linter", run = "tombi lint" }
fix-toml = { description = "Run Tombi TOML formatter/linter on all TOML files", run = "tombi format" }
check = { description = "Run all check-* tasks", run = "mise run check-py && mise run check-toml && mise run check-pytype" }
fix = { description = "Run all fix-* tasks", run = "mise run fix-py && mise run fix-toml" }
test-gen = { description = "Generate molecules for 1bvr pocket using ZINC pretrained model", run = '''
pixi run python main_generate.py \
  -pkt test_samples/test_pocket10/1bvr_C_rec_pocket10-surf.pdb \
  --ckpt ckpt/ZINC-pretrained-255000.pt \
  -n 10 \
  --name 1bvr \
  -d cpu \
  --root_path gen_results \
  --with_print 1
''' }

[tasks.check-pytype]
description = "Typecheck python code with basedpyright"
usage = 'arg "[files]" help="Files or directories to typecheck (default: .)" var=#true default="."'
run = '''
#!/usr/bin/env bash
set -euo pipefail
# `basedpyright` is installed in the Pixi `lint` env (dev tooling only), not the default runtime env.
pixi run -e lint basedpyright ${usage_files:-.}
'''
